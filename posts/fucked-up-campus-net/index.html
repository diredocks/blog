<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   <meta name="description" content="我时常因为没法白嫖而无能狂怒。
好吧，也不是纯白嫖，毕竟一个月还是交了些钱给运营商，那我凭啥就不能给几台设备用？ 于是开始折腾，折腾完了认证程序就开始得寸进尺，想：我能不能不认证就上网，纯白嫖呢？
很遗憾，基本做不到。我们来看一下市面上常见的技术路线：
白嫖全家桶 基于 UDP 53 端口的代理 地球人都知道，用于域名查询的 DNS 协议走的是 UDP 流量，所以基本上白嫖途径都是想在这动手脚（还有些邪门的——比方说给学校主机挂马的我就不说了）。有些防火墙（或者管理员）比较脑残，在你没登陆的情况下直接放行所有 53 端口的 UDP 流量，初衷是供你在没登陆的时候能浏览校内服务，但是我们可以直接在公网服务器（或者另一台已联网的校内主机）开个 UDP 代理作为跳板转发咱的流量啊！这样连上跳板服务器的代理，我们就能通过这台服务器上网。
那要是管理员非常鸡贼的只允许 DNS 查询呢？或者交换机会劫持 DNS 查询到内部服务器呢？这条路就死翘翘了。
ICMP 隧道 ping 一下任意主机，结果发现能 ping 通？这就不能怪我白嫖了&hellip; ICMP 隧道就是一类将 TCP/UDP 数据包封装进 ICMP 数据包的技术。通过套娃伪装，防火墙只会觉得你在温柔的呼唤网络上的主机，毕竟小小的 ping 还能有什么坏心思呢？
可惜在你校，这条技术路线也不行————没认证？你 ping 个头呢。
DNS 隧道 好吧，既然只有 DNS 流量放行，那咱就伪装成 DNS 流量吧。但问题在与：虽然 DNS 回复包理论上大小可以没有上限（在超过大小限制后会自动转为用 TCP 通信），但查询包有大小限制，就只能把要发送的数据包切分拆了发出去，服务器那边接收到之后再合并。何况 UDP 发送接收不稳定，你带得有额外的机制保证包被正确合并。不用想就知道，这么一通折腾下来，连接必然是卡顿的、性能必然是拉胯的————到头咱还不如用流量。
你专校园网是咋认证的？ 我是小白，纯粹凭感觉写的文章，要严谨（喜欢被 RFC 折磨）请戳 民间 H3C inode 客户端黑历史
在机群中遇见彼此 首先，需要认证的客户端会向整个网络发送一个广播，说：
“我要开始认证了，认证服务器是哪位？”
这个包被称为 EAPoL-Start，在认证服务器接收到包之后，又会对我们说：
“哈喽是我，你 V 我身份信息证明实力！”">  

  <title>
    
      天杀的校园网
    
  </title>


  <link rel="shortcut icon" type="image/x-icon" href="/blog/" />
  
  
  
  <link rel="stylesheet" href="/blog/css/main.c5af9bae99b4a3d315b9f39305ffff27e9c3383fbbfd8b5fcaf2237667021a333a982fb958d1813a720b0a660b14022337553ae1ca93ef2ee17c4ae628ac19cb.css" integrity="sha512-xa&#43;brpm0o9MVufOTBf//J&#43;nDOD&#43;7/YtfyvIjdmcCGjM6mC&#43;5WNGBOnILCmYLFAIjN1U64cqT7y7hfErmKKwZyw==" />
  
</head>
<body a="auto">
        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="/blog/">..</a>


<article>
    <p class="post-meta">
        <time datetime="2024-04-21 00:24:03 &#43;0800 CST">
            2024-04-21
        </time>
    </p>

    <h1>天杀的校园网</h1>

    

    <p>我时常因为没法白嫖而无能狂怒。</p>
<p>好吧，也不是纯白嫖，毕竟一个月还是交了些钱给运营商，那我凭啥就不能给几台设备用？  于是开始折腾，折腾完了认证程序就开始得寸进尺，想：<strong>我能不能不认证就上网，纯白嫖呢？</strong></p>
<p>很遗憾，基本做不到。我们来看一下市面上常见的技术路线：</p>
<h2 id="白嫖全家桶">白嫖全家桶</h2>
<h3 id="基于-udp-53-端口的代理">基于 UDP 53 端口的代理</h3>
<p>地球人都知道，用于域名查询的 DNS 协议走的是 UDP 流量，所以基本上白嫖途径都是想在这动手脚（还有些邪门的——比方说给学校主机挂马的我就不说了）。有些防火墙（或者管理员）比较脑残，在你没登陆的情况下直接放行所有 53 端口的 UDP 流量，初衷是供你在没登陆的时候能浏览校内服务，但是我们可以直接在公网服务器（或者另一台已联网的校内主机）开个 UDP 代理作为跳板转发咱的流量啊！这样连上跳板服务器的代理，我们就能通过这台服务器上网。</p>
<p>那要是管理员非常鸡贼的只允许 DNS 查询呢？或者交换机会劫持 DNS 查询到内部服务器呢？这条路就死翘翘了。</p>
<h3 id="icmp-隧道">ICMP 隧道</h3>
<p>ping 一下任意主机，结果发现能 ping 通？这就不能怪我白嫖了&hellip; ICMP 隧道就是一类将 TCP/UDP 数据包封装进 ICMP 数据包的技术。通过套娃伪装，防火墙只会觉得你在温柔的呼唤网络上的主机，毕竟小小的 ping 还能有什么坏心思呢？</p>
<p>可惜在你校，这条技术路线也不行————没认证？你 ping 个头呢。</p>
<h3 id="dns-隧道">DNS 隧道</h3>
<p>好吧，既然只有 DNS 流量放行，那咱就伪装成 DNS 流量吧。但问题在与：虽然 DNS 回复包理论上大小可以没有上限（在超过大小限制后会自动转为用 TCP 通信），但查询包有大小限制，就只能把要发送的数据包切分拆了发出去，服务器那边接收到之后再合并。何况 UDP 发送接收不稳定，你带得有额外的机制保证包被正确合并。不用想就知道，这么一通折腾下来，连接必然是卡顿的、性能必然是拉胯的————到头咱还不如用流量。</p>
<h2 id="你专校园网是咋认证的">你专校园网是咋认证的？</h2>
<p>我是小白，纯粹凭感觉写的文章，要严谨（<del>喜欢被 RFC 折磨</del>）请戳 <a href="https://fjkfwz.github.io/2014/12/04/H3C-inode-Linux/">民间 H3C inode 客户端黑历史</a></p>
<h3 id="在机群中遇见彼此">在机群中遇见彼此</h3>
<p>首先，需要认证的客户端会向整个网络发送一个广播，说：</p>
<blockquote>
<p>“我要开始认证了，认证服务器是哪位？”</p>
</blockquote>
<p>这个包被称为 EAPoL-Start，在认证服务器接收到包之后，又会对我们说：</p>
<blockquote>
<p>“哈喽是我，你 V 我身份信息证明实力！”</p>
</blockquote>
<p>这个包根据校方的配置会不同，都称为 EAP-Request，有不同类型的 Requests.不过不重要，他们的作用都是告诉你认证服务器的 MAC 地址是多少。知道 MAC 地址之后，我们就只跟这个 MAC 地址进行认证通讯了。</p>
<p>同时，如上所述，这个 Request 包还会要求你返回身份信息，当提交身份信息后，认证服务器会转发你的身份信息给远端，由远端决定让不让你入网。当她批准你入网之后，你才会被认证服务器从“未授权”端口，转接到“授权”端口。</p>
<h3 id="刷卡进站">刷卡进站</h3>
<p>啥是 <strong>“授权/未授权”</strong> 呢？通俗来讲就是一个池子：</p>
<p>你没通过组织的考验之前都得给你关在“未授权”里，此时你只能和特定设备：DHCP 服务器（为了让你能分到 ip 地址）、存放客户端的文件服务器（你总得有个机会开始认证）、认证服务器（不然找谁认证呢？）沟通。</p>
<p>只有跟组织沟通好情况，得到组织批复之后，才会变成“授权”端口：此时你才能访问本地别的主机，以及互联网内容。</p>

</article>

            </div>
        </main>
    </body></html>
